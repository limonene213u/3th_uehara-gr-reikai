<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>南④地区会 3月例会 回答状況</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', sans-serif; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">

<!-- パスワード画面 -->
<div id="auth-screen" class="fixed inset-0 bg-gray-900 flex items-center justify-center z-50">
  <div class="bg-white rounded-2xl shadow-2xl p-10 w-full max-w-sm text-center">
    <div class="text-4xl mb-3">🔒</div>
    <h1 class="text-lg font-bold text-gray-700 mb-1">南④地区会</h1>
    <p class="text-sm text-gray-400 mb-6">3月例会 回答状況</p>
    <input id="pw-input" type="password" placeholder="パスワード"
      class="w-full border border-gray-300 rounded-lg px-4 py-3 text-center text-lg tracking-widest focus:outline-none focus:ring-2 focus:ring-teal-400 mb-3"
      onkeydown="if(event.key==='Enter') checkPassword()">
    <button onclick="checkPassword()"
      class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 rounded-lg transition">入る</button>
    <p id="pw-error" class="text-red-500 text-sm mt-3 hidden">パスワードが違います</p>
  </div>
</div>

<!-- メインコンテンツ -->
<div id="main-content" class="hidden">
  <header class="bg-teal-700 text-white shadow">
    <div class="container mx-auto px-6 py-4 max-w-2xl">
      <p class="text-xs text-teal-200">南④地区会 令和7年度3月例会</p>
      <h1 class="text-lg font-bold">回答状況ダッシュボード</h1>
      <p id="last-updated" class="text-teal-300 text-xs mt-1"></p>
    </div>
  </header>

  <main class="container mx-auto px-4 py-6 max-w-2xl">

    <div id="loading" class="text-center py-16 text-gray-400">読み込み中...</div>
    <div id="error-msg" class="hidden bg-red-100 text-red-700 rounded-xl p-6 text-center">
      データの取得に失敗しました。
    </div>

    <div id="content" class="hidden space-y-5">

      <!-- 役員会カード -->
      <div class="bg-white rounded-xl shadow p-6 border-t-4 border-teal-500">
        <h2 class="font-bold text-gray-700 text-base mb-4">📋 役員会 回答状況</h2>

        <div class="grid grid-cols-4 gap-3 mb-5 text-center">
          <div>
            <p class="text-xs text-gray-400 mb-1">対象</p>
            <p id="kpi-total" class="text-2xl font-bold text-gray-700">-</p>
            <p class="text-xs text-gray-400">名</p>
          </div>
          <div>
            <p class="text-xs text-gray-400 mb-1">出席</p>
            <p id="kpi-attended" class="text-2xl font-bold text-teal-600">-</p>
            <p class="text-xs text-gray-400">名</p>
          </div>
          <div>
            <p class="text-xs text-gray-400 mb-1">欠席</p>
            <p id="kpi-absent" class="text-2xl font-bold text-yellow-500">-</p>
            <p class="text-xs text-gray-400">名</p>
          </div>
          <div>
            <p class="text-xs text-gray-400 mb-1">未回答</p>
            <p id="kpi-noreply" class="text-2xl font-bold text-red-500">-</p>
            <p class="text-xs text-gray-400">名</p>
          </div>
        </div>

        <div class="space-y-2">
          <div class="flex justify-between text-sm mb-1">
            <span class="text-gray-500">回答率</span>
            <span id="reply-rate-text" class="font-bold text-teal-600">-%</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3">
            <div id="reply-rate-bar" class="bg-teal-500 h-3 rounded-full transition-all duration-700" style="width:0%"></div>
          </div>
          <div class="flex justify-between text-sm mt-2">
            <span class="text-gray-500">出席率</span>
            <span id="attend-rate-text" class="font-bold text-green-600">-%</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div id="attend-rate-bar" class="bg-green-500 h-2 rounded-full transition-all duration-700" style="width:0%"></div>
          </div>
        </div>
      </div>

      <!-- グループ別カード -->
      <div class="bg-white rounded-xl shadow p-6 border-t-4 border-orange-400">
        <h2 class="font-bold text-gray-700 text-base mb-4">👥 グループ別 未回答者数</h2>
        <div id="group-list" class="space-y-3"></div>
        <div class="mt-4 pt-4 border-t border-gray-100 flex justify-between items-center">
          <span class="text-sm text-gray-500 font-medium">合計未回答</span>
          <span id="total-noreply" class="text-xl font-bold text-red-500">- 名</span>
        </div>
      </div>

    </div>
  </main>
</div>

<script>
  const GAS_URL  = "https://script.google.com/macros/s/AKfycbyv8RFdPsG-8iKrj_p8WBpqeLZ8RBZ_qO5MSOP-iz0m-jDsEgnGzH9m0POzJJ2ayC0x/exec";
  const PASSWORD = "reikai2026";                 // ← 任意のパスワードに変更

  function checkPassword() {
    if (document.getElementById('pw-input').value === PASSWORD) {
      document.getElementById('auth-screen').classList.add('hidden');
      document.getElementById('main-content').classList.remove('hidden');
      fetchData();
    } else {
      document.getElementById('pw-error').classList.remove('hidden');
      document.getElementById('pw-input').value = '';
    }
  }

  async function fetchData() {
    try {
      const res  = await fetch(GAS_URL);
      const data = await res.json();
      render(data);
    } catch (e) {
      document.getElementById('loading').classList.add('hidden');
      document.getElementById('error-msg').classList.remove('hidden');
    }
  }

  function render(data) {
    document.getElementById('loading').classList.add('hidden');
    document.getElementById('content').classList.remove('hidden');

    // 更新日時
    const d = new Date(data.generated_at);
    document.getElementById('last-updated').textContent =
      `${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()} ${d.getHours()}:${String(d.getMinutes()).padStart(2,'0')} 現在`;

    // 役員会
    const y = data.yakuin;
    document.getElementById('kpi-total').textContent    = y.total;
    document.getElementById('kpi-attended').textContent = y.attended;
    document.getElementById('kpi-absent').textContent   = y.absent;
    document.getElementById('kpi-noreply').textContent  = y.no_reply;
    document.getElementById('reply-rate-text').textContent  = y.reply_rate + '%';
    document.getElementById('attend-rate-text').textContent = y.attend_rate + '%';
    setTimeout(() => {
      document.getElementById('reply-rate-bar').style.width  = y.reply_rate + '%';
      document.getElementById('attend-rate-bar').style.width = y.attend_rate + '%';
    }, 100);

    // グループ別
    const list = document.getElementById('group-list');
    let total = 0;
    list.innerHTML = '';
    data.groups.forEach(g => {
      total += Number(g.no_reply);
      list.innerHTML += `
        <div class="flex items-center justify-between py-2 border-b border-gray-50">
          <span class="text-sm font-medium text-gray-700">${g.group}</span>
          <span class="text-lg font-bold text-red-500">${g.no_reply} <span class="text-sm font-normal text-gray-400">名</span></span>
        </div>`;
    });
    document.getElementById('total-noreply').textContent = total + ' 名';
  }
</script>
</body>
</html>
